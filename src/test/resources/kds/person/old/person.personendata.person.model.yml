format: "0.2.0"
version: "0.2.0"

# No fhirConfig, because this model has no direct Resource equivalent in FHIR. It can only be used in openEHR Archetype slots or as FHIR Resource attribute.

openEhrConfig:
  archetype: "openEHR-EHR-CLUSTER.person.v1"

mappings:


  - name: "pid"
    with:
      fhir: "$fhirRoot.identifier"
      openehr: "$openEhrArchetype.pid"
      type: "IDENTIFIER"
    condition:
      targetRoot: "$fhirRoot.identifier"
      targetAttribute: "system"
      operator: "one of"
      criteria: "[id]"

  - name: "person data name"
    with:
      fhir: "$fhirRoot.name"
      openehr: "$openEhrArchetype.geburtsname"
      type: "NONE"
    slotArchetype: "openEHR-EHR-CLUSTER.structured_name.v1"

  - name: "non structured name"
    with:
      fhir: "$fhirRoot.name.text"
      openehr: "$openEhrArchetype.name"
      type: "STRING"

  - name: "organization"
    with:
      fhir: "$fhirRoot.managingOrganization"
      openehr: "$reference" # the path of the following reference mapping will be used
      type: "NONE"
    # States the FHIR target/source is a Reference.
    reference:
      # Implicitly is a "direct" reference, i.e. creates ad-hoc sub-resource. It will be added to the Bundle and referenced in the root Resource.
      resourceType: "Organization"
      mappings:
        - name: "org"
          with:
            fhir: "$fhirRoot"
            openehr: "$openEhrArchetype.verwaltungsorganisation"
            type: "NONE"
          followedBy:
            mappings:
              - name: "org name"
                with:
                  fhir: "name"
                  openehr: "namenszeile"
                  type: "STRING"

              - name: "org id"
                with:
                  fhir: "identifier"
                  openehr: "identifier.identifier_value"
                  type: "IDENTIFIER"

  - name: "person data address"
    with:
      fhir: "$fhirRoot"
      openehr: "$openEhrArchetype"
      type: "NONE"
    slotArchetype: "openEHR-EHR-CLUSTER.address.v1"

  - name: "gkv identifier"
    with:
      fhir: "$fhirRoot.identifier"
      openehr: "$openEhrArchetype.versicherten_id_gkv"
      type: "IDENTIFIER"
    condition:
      targetRoot: "$fhirRoot.identifier"
      targetAttribute: "system"
      operator: "one of"
      criteria: "[gkv]"

  - name: "pvk identifier"
    with:
      fhir: "$fhirRoot.identifier"
      openehr: "$openEhrArchetype.versicherungsnummer_pkv"
      type: "IDENTIFIER"
    condition:
      targetRoot: "$fhirRoot.identifier"
      targetAttribute: "system"
      operator: "one of"
      criteria: "[pkv]"
