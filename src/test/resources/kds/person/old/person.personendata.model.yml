format: "0.2.0"
version: "0.0.1"

fhirConfig:
  resource: "Patient"
  multiple: false
openEhrConfig:
  archetype: "openEHR-EHR-ADMIN_ENTRY.person_data.v0"

mappings:

  - name: "person data"
    with:
      fhir: "$fhirResource"
      openehr: "$openEhrArchetype.personendaten.person"
      type: "NONE"
    slotArchetype: "openEHR-EHR-CLUSTER.person.v1"

  - name: "death details"
    with:
      fhir: "$fhirResource"
      openehr: "$openEhrArchetype"
      type: "NONE"
    slotArchetype: "openEHR-EHR-CLUSTER.death_details.v1"

  - name: "vital status"
    with:
      fhir: "Observation"
      openehr: "$openEhrArchetype.vitalstatus"
      type: "NONE"
    followedBy:
      mappings:
        - name: "status"
          with:
            fhir: "note.text"
            openehr: "vitalstatus"
            type: "STRING"
        - name: "fhir status"
          with:
            fhir: "status"
            openehr: "fhir_status_der_beobachtung.status"
            type: "STRING"
        - name: "effective"
          with:
            fhir: "effective"
            openehr: "zeitpunkt_der_feststellung"
            type: "DATETIME"

  - name: "person birth date"
    with:
      fhir: "$fhirResource.birthDate"
      openehr: "$openEhrArchetype.personendaten"
      type: "NONE"
    slotArchetype: "openEHR-EHR-CLUSTER.person_birth_data_iso.v0"
    followedBy:
      mappings:
        - name: "person birth date deceased information"
          with:
            fhir: "extension.value"
            openehr: "angaben_zum_tod.verstorben"
            type: "BOOL"
          condition:
            targetRoot: "extension"
            targetAttribute: "url"
            operator: "one of"
            criteria: "[isdeceased]"

  - name: "contact person"
    with:
      fhir: "$fhirResource.contact"
      openehr: "$openEhrArchetype.personendaten.kontaktperson"
      type: "NONE"
    slotArchetype: "openEHR-EHR-CLUSTER.person.v1"
    followedBy:
      mappings:
        - name: "role"
          with:
            fhir: "relationship"
            openehr: "rolle_relationship"
            type: "CODEABLECONCEPT"
        - name: "address"
          with:
            fhir: "address.text"
            openehr: "adresse.adresszeile"
            type: "STRING"
        - name: "telecom"
          with:
            fhir: "telecom.value"
            openehr: "elektronische_kommunikation.daten.text_value"
            type: "STRING"
        - name: "organization"
          with:
            fhir: "organization"
            openehr: "$reference"
            type: "NONE"
          reference:
            resourceType: "Organization"
            mappings:
              - name: "org"
                with:
                  fhir: "$fhirRoot"
                  openehr: "organisation"
                  type: "NONE"
                followedBy:
                  mappings:
                    - name: "org name"
                      with:
                        fhir: "name"
                        openehr: "namenszeile"
                        type: "STRING"

