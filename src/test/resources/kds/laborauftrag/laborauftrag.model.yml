format: "0.2.0"
version: "0.0.1"

fhirConfig:
  resource: "ServiceRequest"
  multiple: false
openEhrConfig:
  archetype: "openEHR-EHR-INSTRUCTION.service_request.v1"

mappings:
  - name: "identifier"
    with:
      fhir: "$fhirResource.identifier.value"
      openehr: "$openEhrArchetype.laborleistung.receiver_order_identifier.text_value"
      type: "STRING"

  - name: "status"
    with:
      fhir: "$fhirResource.status"
      openehr: "$openEhrArchetype.laborleistung.request_status"
      type: "CODING"

  - name: "code"
    with:
      fhir: "$fhirResource.code"
      openehr: "$openEhrArchetype.laborleistung.current_activity.name_der_laborleistung"
      type: "CODEABLECONCEPT"
  - name: "category"
    with:
      fhir: "$fhirResource.category"
      openehr: "$openEhrArchetype.laborleistung.current_activity.art_der_laborleistung_kategorie"
      type: "CODEABLECONCEPT"
  - name: "intent"
    with:
      fhir: "$fhirResource.intent"
      openehr: "$openEhrArchetype.laborleistung.current_activity.intent"
      type: "CODING"

  - name: "note"
    with:
      fhir: "$fhirResource.note.text"
      openehr: "$openEhrArchetype.laborleistung.current_activity.comment"
      type: "STRING"


  - name: "organisation"
    with:
      fhir: "$fhirResource.requester.as(Organization)"
      openehr: "$reference"
      type: "NONE"
    reference:
      resourceType: "Organization"
      mappings:
        - name: "org"
          with:
            fhir: "$fhirRoot"
            openehr: "$openEhrArchetype.laborleistung.einsender"
            type: "NONE"
          followedBy:
            mappings:
              - name: "org name"
                with:
                  fhir: "name"
                  openehr: "name"
                  type: "TEXT"
              - name: "org id"
                with:
                  fhir: "identifier"
                  openehr: "identifier"
                  type: "IDENTIFIER"



  - name: "specimen"
    with:
      fhir: "$fhirResource.specimen"
      openehr: "$reference"
      type: "NONE"
    reference:
      resourceType: "Specimen"
      mappings:
        - name: "specimen recurring"
          with:
            fhir: "$fhirRoot"
            openehr: "$openEhrArchetype.laborleistung.current_activity.specimen" # you need to do this because specimen is recurring element in openehr
            type: "NONE"
          followedBy:
            mappings:
              - name: "specimen identifier"
                with:
                  fhir: "identifier"
                  openehr: "laboratory_specimen_identifier"
                  type: "IDENTIFIER"
              - name: "specimen collection"
                with:
                  fhir: "collection"
                  openehr: "$openEhrArchetype"
                  type: "NONE"
                followedBy:
                  mappings:
                    - name: "specimen collection date time"
                      with:
                        fhir: "collected.as(DateTimeType)"
                        openehr: "collection_date_time.date_time_value"
                        type: "DATETIME"
                    - name: "specimen collector"
                      with:
                        fhir: "collector.as(Reference).identifier" # if you don't explicitly cast to Reference, it will try to add a Resource
                        openehr: "specimen_collector_identifier"
                        type: "IDENTIFIER"

