format: "0.2.0"
version: "0.0.1"

fhirConfig:
  resource: "Condition"
  multiple: true
  condition:
    - targetRoot: "$fhirResource"
      targetAttribute: "extension.url"
      operator: "one of"
      criteria: "[http://hl7.org/fhir/StructureDefinition/condition-related]"
openEhrConfig:
  archetype: "openEHR-EHR-EVALUATION.problem_diagnosis.v1"

mappings:

  - name: "condition type terminology"
    with:
      #            fhir: "" NO FHIR meaning it's not mapped from anywhere but a hardcoded thing that will show up in openEHR only
      openehr: "$openEhrArchetype.diagnose.klinischer_status.referenzprimaerdiagnose|terminology"
      value: "local" # value is a new thing because its a hardcoded type
  - name: "condition type code"
    with:
      openehr: "$openEhrArchetype.diagnose.klinischer_status.referenzprimaerdiagnose|code"
      value: "at0064" # value is a new thing because its a hardcoded type
  - name: "condition type value"
    with:
      openehr: "$openEhrArchetype.diagnose.klinischer_status.referenzprimaerdiagnose|value"
      value: "Hauptdiagnose" # value is a new thing because its a hardcoded type

  - name: "sekund√§rcode"
    with:
      fhir: "$fhirResource.extension"
      openehr: "$openEhrArchetype.diagnose"
      type: "NONE"
    condition:
      targetRoot: "$fhirResource.extension"
      targetAttribute: "url"
      operator: "one of"
      criteria: "[http://hl7.org/fhir/StructureDefinition/condition-related]"
    followedBy:
      mappings:
        - name: "condition type terminology"
          with:
            #            fhir: "" NO FHIR meaning it's not mapped from anywhere but a hardcoded thing that will show up in openEHR only
            openehr: "$openEhrArchetype.diagnose.klinischer_status.referenzprimaerdiagnose|terminology"
            value: "local" # value is a new thing because its a hardcoded type
        - name: "condition type code"
          with:
            openehr: "$openEhrArchetype.diagnose.klinischer_status.referenzprimaerdiagnose|code"
            value: "at0066" # value is a new thing because its a hardcoded type
        - name: "condition type value"
          with:
            openehr: "$openEhrArchetype.diagnose.klinischer_status.referenzprimaerdiagnose|value"
            value: "Nebendiagnose" # value is a new thing because its a hardcoded type


        - name: "referenced condition"
          with:
            fhir: "value"
            openehr: "$reference"
            type: "NONE"
          reference:
            resourceType: "Condition"
            mappings:
              - name: "sekundar"
                with:
                  fhir: "$fhirRoot"
                  openehr: "$openEhrArchetype"
                  type: "NONE"
                slotArchetype: "openEHR-EHR-EVALUATION.problem_diagnosis.v1"
