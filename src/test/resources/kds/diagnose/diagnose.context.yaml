format: "0.2.0"

openEHR:
  templateId: "KDS_Diagnose"
  archetypes:
    - "openEHR-EHR-CLUSTER.anatomical_location.v1"
    - "openEHR-EHR-CLUSTER.lebensphase.v0"
    - "openEHR-EHR-CLUSTER.multiple_coding_icd10gm.v1"
    - "openEHR-EHR-EVALUATION.problem_diagnosis.v1"

fhir:
  resourceType: "Bundle"
  condition:
    targetRoot: "$fhirResource"
    targetAttribute: "entry.resource.meta.profile"
    operator: "one of"
    criteria: "[https://www.medizininformatik-initiative.de/fhir/core/modul-diagnose/StructureDefinition/Diagnose]"

# a post processor kind of thing evaluated on a whole bundle after everything has been mapped and done
# it would include pre-defined set of actions, one of those can be "references" indicating that references within
# the Bundle would need to be "done". The other can be "id" or something like that which would handle ID generation/handling (/issues/14), ..
#  only for openEHR to FHIR !
#  references:
##    fhir path pointing to primary secondary diagnosis
#    source: "Bundle.where(Resource.extension.[http://hl7.org/fhir/StructureDefinition/condition-related]).extensions.url"
#    target: "Bundle.where(Resource.extension.not in t[http://hl7.org/fhir/StructureDefinition/condition-related]"

  mappings:
    name: "reference_primary"
    type: "Reference"
    main: #refine name
      referenceEndpoint: "$fhirResourse.extension(url=sadsadads).value"
      condition:
          targetRoot: "$fhirResource"
          targetAttribute: "extension.url"
          operator: "one of" #not in as an operator
          criteria: "[http://hl7.org/fhir/StructureDefinition/condition-related]"
    referencedResource:
      condition:
        targetRoot: "$fhirResource"
        targetAttribute: "extension.url"
        operator: "not in" #not in as an operator
        criteria: "[http://hl7.org/fhir/StructureDefinition/condition-related]"


