engine: FHIRConnect/v0.0.1
type: extension
metadata:
  name: KDSLaborauftrag
  version: 0.0.1a
spec:
  system: FHIR
  version: R4
  openEhrConfig:
    archetype: openEHR-EHR-INSTRUCTION.service_request.v1
  fhirConifg:
    profile: "https://www.medizininformatik-initiative.de/fhir/core/modul-labor/StructureDefinition/ServiceRequestLab"

mappings:
  - name: "fallIdentifikation"
    extension: "add"
    with:
      fhir: "$fhirResource.encounter"
      openehr: "$reference"
    reference:
      resourceType: "Encounter"
      mappings:
        - name: "identifierInReference"
          with:
            fhir: "$fhirRoot"
            openehr: "$composition/context/other_context[at0001]/items[openEHR-EHR-CLUSTER.case_identification.v0]"
          slotArchetype: "openEHR-EHR-CLUSTER.case_identification.v0"


  - name: "specimen"
    extension: "add"
    with:
      fhir: "$fhirResource.specimen"
      openehr: "$reference"
    reference:
      resourceType: "Specimen"
      mappings:
        - name: "specimenReference"
          with:
            fhir: "$fhirRoot"
            openehr: "$openEhrArchetype/activities[at0001]/description[at0009]/items[openEHR-EHR-CLUSTER.specimen.v1]"
          slotArchetype: "openEHR-EHR-CLUSTER.specimen.v1"
      #   - name: "specimen recurring" TODO i dont get that is this necessary ?
      #     with:
      #       fhir: "$fhirRoot"
      #       openehr: "$openEhrArchetype/activities[at0001]/description[at0009]/items[openEHR-EHR-CLUSTER.specimen.v1]" # you need to do this because specimen is recurring element in openehr
      #       type: "NONE"

  - name: "organisation"
    extension: "add"
    with:
      fhir: "$fhirResource.requester.as(Organization)"
      openehr: "$reference"
    reference:
      resourceType: "Organization"
      mappings:
        - name: "organizationReference"
          with:
            fhir: "$fhirRoot"
            openehr: "$openEhrArchetype/protocol[at0008]/items[openEHR-EHR-CLUSTER.organisation.v1]"
          slotArchetype: "openEHR-EHR-CLUSTER.organisation.v1"





