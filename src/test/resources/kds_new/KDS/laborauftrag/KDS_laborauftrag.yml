engine: FHIRConnect/v0.0.1
type: extension
metadata:
  name: KDSLaborauftrag
  version: 0.0.1a
spec:
  system: FHIR
  version: R4
  openEhrConfig:
    archetype: openEHR-EHR-INSTRUCTION.service_request.v1

mappings:
  - name: "fallIdentifikation"
    extension: "add"
    with:
      fhir: "$resourcePath.encounter"
      openehr: "$reference"
    reference:
      resourceType: "Encounter"
      mappings:
        - name: "identifierInReference"
          with:
            fhir: "$fhirRoot"
            openehr: "$compositionPath/context/other_context[at0001]/items[openEHR-EHR-CLUSTER.case_identification.v0]"
          slotArchetype: "openEHR-EHR-CLUSTER.case_identification.v0"
        - name: "cascadeMapping"
          with:
            fhir: "$fhirRoot"
            openehr: "$compositionPath/context/other_context[at0001]/items[openEHR-EHR-CLUSTER.case_identification.v0]" # will use link
            type: "REFERENCED_MAPPING" # execute mapping or use already mapped one to get Composition URI
            openehrLink:
              meaning: "the case this composition relates to"
              type: "case link"


  - name: "specimen"
    extension: "add"
    with:
      fhir: "$resourcePath.specimen"
      openehr: "$reference"
    reference:
      resourceType: "Specimen"
      mappings:
        - name: "specimenReference"
          with:
            fhir: "$fhirRoot"
            openehr: "$archetypePath/activities[at0001]/description[at0009]/items[openEHR-EHR-CLUSTER.specimen.v1]"
          slotArchetype: "openEHR-EHR-CLUSTER.specimen.v1"
      #   - name: "specimen recurring" TODO i dont get that is this necessary ?
      #     with:
      #       fhir: "$fhirRoot"
      #       openehr: "$archetypePath/activities[at0001]/description[at0009]/items[openEHR-EHR-CLUSTER.specimen.v1]" # you need to do this because specimen is recurring element in openehr
      #       type: "NONE"

  - name: "organisation"
    extension: "add"
    with:
      fhir: "$resourcePath.requester.as(Organization)"
      openehr: "$reference"
    reference:
      resourceType: "Organization"
      mappings:
        - name: "organizationReference"
          with:
            fhir: "$fhirRoot"
            openehr: "$archetypePath/protocol[at0008]/items[openEHR-EHR-CLUSTER.organisation.v1]"
          slotArchetype: "openEHR-EHR-CLUSTER.organisation.v1"





