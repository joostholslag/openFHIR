engine: FHIRConnect/v0.0.1
type: model
metadata:
  name: service_request.v1
  version: 0.0.1a
spec:
  system: FHIR
  version: R4
  openEhrConfig:
    archetype: openEHR-EHR-CLUSTER.specimen.v1
  fhirConfig:
    profile: http://hl7.org/fhir/StructureDefinition/Specimen

mappings:
  - name: "specimenIdentifier"
    with:
      fhir: "$resourcePath.identifier"
      openehr: "$archetypePath/items[at0001]"

  - name: "specimenCollection"
    with:
      fhir: "$resourcePath.collection"
      openehr: "$archetypePath"
      type: "NONE"
    followedBy:
      mappings:
        - name: "specimenCollectionDateTime"
          with:
            fhir: "specimenCollectionDateTime" # same as onset; try to provide both and use the one that's present
            openehr: "/items[at0015]"
        - name: "specimenCollector"
          with:
            fhir: "collector.as(Reference).identifier" # explicitly cast to Reference to avoid adding a Resource
            openehr: "/items[at0070]"
        - name: "specimenCollectionMethod"
          with:
            fhir: "method"
            openehr: "/items[at0007]"
        - name: "specimenCollectionBodySite"
          with:
            fhir: "bodySite.text"
            openehr: "/items[at0087]"

  - name: "specimenType"
    with:
      fhir: "$resourcePath.type"
      openehr: "$archetypePath/items[at0029]"

  - name: "specimenNote"
    with:
      fhir: "note.text"
      openehr: "$archetype/items[at0045]"

