engine: FHIRConnect/v0.0.1
type: model
metadata:
  name: service_request.v1
  version: 0.0.1a
spec:
  system: FHIR
  version: R4
  openEhrConfig:
    archetype: openEHR-EHR-CLUSTER.specimen.v1
  fhirConfig:
    profile: http://hl7.org/fhir/StructureDefinition/Specimen

mappings:
  - name: "specimenIdentifier"
    with:
      fhir: "$fhirResource.identifier"
      openehr: "$openehrArchetype/items[at0001]"
      type: "IDENTIFIER"

  - name: "specimenCollection"
    with:
      fhir: "$fhirResource.collection"
      openehr: "$openEhrArchetype"
      type: "NONE"
    followedBy:
      mappings:
        - name: "specimenCollectionDateTime"
          with:
            fhir: "collected" # same as onset; try to provide both and use the one that's present
            openehr: "/items[at0015]"
            type: "DATETIME"
        - name: "specimenCollector"
          with:
            fhir: "collector.as(Reference).identifier" # explicitly cast to Reference to avoid adding a Resource
            openehr: "/items[at0070]"
            type: "IDENTIFIER"
