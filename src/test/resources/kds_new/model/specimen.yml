engine: FHIRConnect/v0.0.1
type: model
metadata:
  name: service_request.v1
  version: 0.0.1a
spec:
  system: FHIR
  version: R4
  openEhrConfig:
    archetype: openEHR-EHR-CLUSTER.specimen.v1
  fhirConfig:
    profile: http://hl7.org/fhir/StructureDefinition/Specimen

mappings:
  - name: "specimenIdentifier"
    with:
      fhir: "$fhirResource.identifier"
      openehr: "$openehrArchetype/items[at0001]"
      type: "IDENTIFIER"

  - name: "specimenCollection"
    with:
      fhir: "$fhirResource.collection"
      openehr: "$openEhrArchetype"
      type: "NONE"
    followedBy:
      mappings:
        - name: "specimenCollectionDateTime"
          with:
            fhir: "collected" # same as onset; try to provide both and use the one that's present
            openehr: "/items[at0015]"
            type: "DATETIME"
        - name: "specimenCollector"
          with:
            fhir: "collector.as(Reference).identifier" # explicitly cast to Reference to avoid adding a Resource
            openehr: "/items[at0070]"
            type: "IDENTIFIER"

  - name: "specimenType"
    with:
      fhir: "$fhirResource.type"
      openehr: "$openehrArchetype/items[at0029]"
      type: "CODEABLECONCEPT"

  - name: "specimenNote"
    with:
      fhir: "note.text"
      openehr: "comment"
      type: "STRING"


  - name: "specimenCollection"
    with:
      fhir: "collection"
      openehr: "$openEhrArchetype"
      type: "NONE"
    followedBy:
      mappings:
        - name: "specimenCollectionDateTime"
          with:
            fhir: "collected.as(DateTimeType)"
            openehr: "collection_date_time.date_time_value"
            type: "DATETIME"

        - name: "specimenCollectionMethod"
          with:
            fhir: "method.text"
            openehr: "collection_method"
            type: "STRING"

        - name: "specimenCollectionBodySite"
          with:
            fhir: "bodySite.text"
            openehr: "k√∂rperstelle"
            type: "STRING"

        - name: "specimenCollector"
          with:
            fhir: "collector.as(Reference).identifier" # if you don't explicitly cast to Reference, it will try to add a Resource
            openehr: "specimen_collector_identifier"
            type: "IDENTIFIER"

