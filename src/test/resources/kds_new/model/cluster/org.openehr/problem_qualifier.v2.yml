engine: FHIRConnect/v0.0.1
type: model
metadata:
  name:  CLUSTER.problem_qualifier.v2
  version: 0.0.1a # version of this particular mapping
spec: # schema specific to the FHIRConnect v0.0.1 engine
  system: FHIR
  version: R4
  openEhrConfig:
    archetype: openEHR-EHR-CLUSTER.problem_qualifier.v2
  fhirConfig:
    structureDefinition: http://hl7.org/fhir/StructureDefinition/BackboneElement

mappings:
#  - name: "statusCoded_fhir"
#    with:
#      fhir: "$fhirRoot.verificationStatus"
#      openehr: "$archetype/items[at0004]"

  - name: "status_provisional_fhir"
    with:
      fhir: "$fhirRoot.verificationStatus.coding"
      openehr: "$archetype"
    openehrCondition:
      targetRoot: "$archetype"
      targetAttributes:
        - "items[at0004]/code_string"
      operator: "one of"
      criteria: "at0017"
    followedBy:
      mappings:
        - name: "status_provisional_fhir_code"
          with:
            fhir: "code"
            value: "provisional"
        - name: "status_provisional_fhir_system"
          with:
            fhir: "system"
            value: "http://hl7.org/fhir/ValueSet/condition-ver-status"
        - name: "status_provisional_fhir_display"
          with:
            fhir: "display"
            value: "Provisional"
  - name: "status_differential_fhir"
    with:
      fhir: "$fhirRoot.verificationStatus.coding"
      openehr: "$archetype"
    openehrCondition:
      targetRoot: "$archetype"
      targetAttributes:
        - "items[at0004]/code_string"
      operator: "one of"
      criteria: "at0017"
    followedBy:
      mappings:
        - name: "status_differential_fhir_code"
          with:
            fhir: "code"
            value: "differential"
        - name: "status_differential_fhir_system"
          with:
            fhir: "system"
            value: "http://hl7.org/fhir/ValueSet/condition-ver-status"
        - name: "status_differential_fhir_display"
          with:
            fhir: "display"
            value: "Differential"

  - name: "status_preliminary_fhir"
    with:
      fhir: "$fhirRoot.verificationStatus.coding"
      openehr: "$archetype"
    openehrCondition:
      targetRoot: "$archetype"
      targetAttributes:
        - "items[at0004]/code_string"
      operator: "one of"
      criteria: "at0016"
    followedBy:
      mappings:
        - name: "status_preliminary_fhir_code"
          with:
            fhir: "code"
            value: "unconfirmed"
        - name: "status_preliminary_fhir_system"
          with:
            fhir: "system"
            value: "http://hl7.org/fhir/ValueSet/condition-ver-status"
        - name: "status_preliminary_fhir_display"
          with:
            fhir: "display"
            value: "Unconfirmed"

  - name: "status_established_fhir"
    with:
      fhir: "$fhirRoot.verificationStatus.coding"
      openehr: "$archetype"
    openehrCondition:
      targetRoot: "$archetype"
      targetAttributes:
        - "items[at0004]/code_string"
      operator: "one of"
      criteria: "at0018"
    followedBy:
      mappings:
        - name: "status_established_fhir_code"
          with:
            fhir: "code"
            value: "confirmed"
            type: "STRING"
        - name: "status_established_fhir_system"
          with:
            fhir: "system"
            value: "http://hl7.org/fhir/ValueSet/condition-ver-status"
            type: "STRING"
        - name: "status_established_fhir_display"
          with:
            fhir: "display"
            value: "Confirmed"
            type: "STRING"

  - name: "status_refuted_fhir"
    with:
      fhir: "$fhirRoot.verificationStatus.coding"
      openehr: "$archetype"
    openehrCondition:
      targetRoot: "$archetype"
      targetAttributes:
        - "items[at0004]/code_string"
      operator: "one of"
      criteria: "at0088"
    followedBy:
      mappings:
        - name: "status_refuted_fhir_code"
          with:
            fhir: "code"
            value: "refuted"
        - name: "status_refuted_fhir_system"
          with:
            fhir: "system"
            value: "http://hl7.org/fhir/ValueSet/condition-ver-status"
        - name: "status_refuted_fhir_display"
          with:
            fhir: "display"
            value: "Refuted"

  - name: "status_provisional_openehr_code"
    with:
      openehr: "items[at0004]/defining_code"
      value: "at0017"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "provisional"
  - name: "status_provisional_openehr_value"
    with:
      openehr: "items[at0004]/value"
      value: "Working"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "provisional"

  - name: "status_differential_openehr_code"
    with:
      openehr: "items[at0004]/defining_code"
      value: "at0017"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "differential"
  - name: "status_differential_openehr_value"
    with:
      openehr: "items[at0004]/value"
      value: "Working"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "differential"

  - name: "status_preliminary_openehr_code"
    with:
      openehr: "items[at0004]/defining_code"
      value: "at0016"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "unconfirmed"
  - name: "status_preliminary_openehr_value"
    with:
      openehr: "items[at0004]/value"
      value: "Preliminary"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "unconfirmed"

  - name: "status_established_openehr_code"
    with:
      openehr: "items[at0004]/defining_code"
      value: "at0018"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "confirmed"
  - name: "status_established_openehr_value"
    with:
      openehr: "items[at0004]/value"
      value: "Established"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "confirmed"

  - name: "status_refuted_openehr_code"
    with:
      openehr: "items[at0004]/defining_code"
      value: "at0088"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "refuted"
  - name: "status_refuted_openehr_value"
    with:
      openehr: "items[at0004]/value"
      value: "Refuted"
    fhirCondition:
      targetRoot: "$fhirRoot.verificationStatus"
      targetAttributes:
        - "coding.code"
      operator: "one of"
      criteria: "refuted"
