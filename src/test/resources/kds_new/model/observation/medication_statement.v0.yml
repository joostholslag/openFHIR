engine: FHIRConnect/v0.0.1
type: model
metadata:
  name:  medication_statement.v0
  version: 0.0.1a # version of this particular mapping
spec: # schema specific to the FHIRConnect v0.0.1 engine
  system: FHIR
  version: R4
  openEhrConfig:
    archetype: openEHR-EHR-OBSERVATION.medication_statement.v0
    revision: 0.0.1a

mappings:
#Medication details at0046
#Overall directions description at0047
#Structured dose and timing  at0045
#Route of administration at0030
#Description at0032
# CLinical indication at0023
# Last administered at0026
# Endcpoint at0037
# Addtional details at0048
# comment at0029

  - name: "hierarchyMappings"
    with:
      fhir: "$resourcePath.dosage"
      openEHR: "$archetypePath/data[at0001]/events[at0002]"
  #    type: "HIERARCHY"
    hierarchy:
      fhirCreate: "resource"
      openehrCreate: "event"
      uniqueValueFHIR: "[route]" # if route value is different per dosage slice make a new event
      uniqueValueOpenEHR: "['/data[at0003]/items[openEHR-EHR-CLUSTER.medication.v2]/items[at0132]']"

  - name: "eventTime"
    with:
      fhir: "$resourcePath.effective"
      openEHR: "$archetypePath/data[at0001]/events[at0002]" # period -> interval event, datetime to pointInTime event

  - name: "note"
    with:
      fhir: "$resourcePath.note.text"
      openehr: "$archetypePath/data[at0001]/events[at0002]/data[at0003]/items[at0029]"

  - name: "structured dosage"
    with:
      fhir: "$resourcePath.dosage"
      openehr: "$archetypePath/data[at0001]/events[at0002]/data[at0003]/items[openEHR-EHR-CLUSTER.dosage.v2]"
    slotArchetype: "openEHR-EHR-CLUSTER.dosage.v2"

  - name: "medication"
    with:
      fhir: "$resourcePath.medication"
      openehr: "$reference"
    reference:
      resourceType: "Medication"
      mappings:
        - name: "medicationReference"
          with:
            fhir: "$fhirRoot"
            openehr: "$archetypePath/data[at0001]/events[at0002]/data[at0003]/items[openEHR-EHR-CLUSTER.medication.v2]"
          slotArchetype: "openEHR-EHR-CLUSTER.medication.v2" # depending on the resourceType picks the correct one


