engine: FHIRConnect/v0.0.1
type: extension
metadata:
  name: KDS_structured_name.v1.person_name-structured_name
  version: 0.0.1-alpha
spec:
  system: FHIR
  version: R4
  extends: CLUSTER.structured_name.v1

mappings:
  - name: "name.prefix" #TODO is wrong in the template only qualifier is displayed has to be fixed.
    extension: "overwrite"
    with:
      fhir: "$fhirRoot.prefix.extension"
      openehr: "$openehrRoot/items[at0006]"
    fhirCondition:
      targetRoot: "$fhirRoot.prefix.extension"
      targetAttribute: "url"
      operator: "one of"
      criteria: "[http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier]"
    followedBy:
      mappings:
        - name: "staticExtensionUrl"
          with:
            fhir: "extension.url"
            openehr: "$reference"
          manual:
            - name: "url"
              fhir:
                - path: "url"
                  url: "http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier"

  - name: "appendFamily"
    appendTo: "name.familyName"
    followedBy:
      mappings:
        - name: "familiennameZusatz"
          with:
            fhir: "extension"
            openehr: "items[at0005 and name/value='Familienname-Namenszusatz']"
          fhirCondition:
            targetRoot: "extension"
            targetAttribute: "url"
            operator: "one of"
            criteria: "[http://fhir.de/StructureDefinition/humanname-namenszusatz]"
          followedBy:
            mappings:
              - name: "staticExtensionUrl"
                with:
                  fhir: "extension"
                  openehr: "$reference"
                manual:
                  - name: "staticUrl"
                    fhir:
                      - path: "url"
                        value: "http://fhir.de/StructureDefinition/humanname-namenszusatz"


        - name: "nachnameOhneZus√§tze"
          with:
            fhir: "extension"
            openehr: "items[at0005 and name/value='Familienname-Nachname']"
          fhirCondition:
            targetRoot: "extension"
            targetAttribute: "url"
            operator: "one of"
            criteria: "[http://hl7.org/fhir/StructureDefinition/humanname-own-name]"
          followedBy:
            mappings:
              - name: "staticExtensionUrl"
                with:
                  fhir: "extension"
                  openehr: "$reference"
                manual:
                  - name: "staticUrl"
                    fhir:
                      - path: "url"
                        value: "http://hl7.org/fhir/StructureDefinition/humanname-own-name"

        - name: "vorsatzwort"
          with:
            fhir: "extension"
            openehr: "items[at0005 and name/value='Familienname-Vorsatzwort']"
          fhirCondition:
            targetRoot: "extension"
            targetAttribute: "url"
            operator: "one of"
            criteria: "[http://hl7.org/fhir/StructureDefinition/humanname-own-prefix]"
          followedBy:
            mappings:
              - name: "staticExtensionUrl"
                with:
                  fhir: "extension"
                  openehr: "$reference"
                manual:
                  - name: "staticUrl"
                    fhir:
                      - path: "url"
                        value:  "http://hl7.org/fhir/StructureDefinition/humanname-own-prefix"

